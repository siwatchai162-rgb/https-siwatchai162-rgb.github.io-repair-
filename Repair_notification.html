<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .status-pending { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .status-progress { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .status-completed { background: linear-gradient(135deg, #10b981, #059669); }
        .status-cancelled { background: linear-gradient(135deg, #ef4444, #dc2626); }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
            
            /* Improve touch targets */
            button, select, input, textarea {
                min-height: 44px;
            }
            
            /* Better scrolling on mobile */
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .overflow-x-auto::-webkit-scrollbar {
                display: none;
            }
        }
        
        /* Tablet optimizations */
        @media (min-width: 641px) and (max-width: 1024px) {
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }
    
/* Lock fields look */
[disabled]{background-color:#f3f4f6 !important; cursor:not-allowed;}
</style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-8">
            <div class="flex justify-between items-center py-3 sm:py-4 lg:py-6">
                <div class="flex items-center min-w-0 flex-1">
                    <div class="bg-blue-500 p-2 sm:p-3 rounded-lg mr-2 sm:mr-4 flex-shrink-0">
                        <svg class="w-6 h-6 sm:w-8 sm:h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                    </div>
                    <div class="min-w-0">
                        <h1 class="text-lg sm:text-xl lg:text-3xl font-bold text-gray-900 truncate">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</h1>
                        <p class="text-xs sm:text-sm text-gray-600 hidden sm:block">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</p>
                    </div>
                </div>
                
                <!-- Mobile Menu Button -->
                <div class="flex items-center space-x-2 sm:hidden">
                    <button onclick="toggleMobileMenu()" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden sm:flex space-x-2 lg:space-x-4">
                    <button onclick="showSection('report')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 lg:px-6 lg:py-3 rounded-lg font-medium transition-colors duration-200 shadow-lg text-sm lg:text-base">
                        <span class="hidden lg:inline">+ ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</span>
                        <span class="lg:hidden">+ ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</span>
                    </button>
                    <button onclick="showSection('dashboard')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 lg:px-6 lg:py-3 rounded-lg font-medium transition-colors duration-200 shadow-lg text-sm lg:text-base">
                        <span class="hidden lg:inline">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span>
                        <span class="lg:hidden">üìä</span>
                    </button>
                    <div class="relative">
                        <button onclick="toggleDataMenu()" class="bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 lg:px-6 lg:py-3 rounded-lg font-medium transition-colors duration-200 shadow-lg text-sm lg:text-base">
                            <span class="hidden lg:inline">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                            <span class="lg:hidden">‚öôÔ∏è</span>
                        </button>
                        <div id="data-menu" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border z-50">
                            <button onclick="exportData()" class="w-full text-left px-4 py-3 hover:bg-gray-50 rounded-t-lg border-b text-sm">
                                üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (CSV)
                            </button>
                            <button onclick="importData()" class="w-full text-left px-4 py-3 hover:bg-gray-50 border-b text-sm">
                                üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                            <button onclick="clearAllData()" class="w-full text-left px-4 py-3 hover:bg-red-50 text-red-600 rounded-b-lg text-sm">
                                üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="hidden sm:hidden border-t border-gray-200 py-3">
                <div class="flex flex-col space-y-2">
                    <button onclick="showSection('report'); toggleMobileMenu()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg font-medium transition-colors text-left">
                        + ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà
                    </button>
                    <button onclick="showSection('dashboard'); toggleMobileMenu()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-medium transition-colors text-left">
                        üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <div class="relative">
                        <button onclick="toggleMobileDataMenu()" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg font-medium transition-colors text-left">
                            ‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <div id="mobile-data-menu" class="hidden mt-2 bg-white rounded-lg shadow-lg border">
                            <button onclick="exportData(); toggleMobileMenu()" class="w-full text-left px-4 py-3 hover:bg-gray-50 rounded-t-lg border-b text-sm">
                                üì§ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (CSV)
                            </button>
                            <button onclick="importData(); toggleMobileMenu()" class="w-full text-left px-4 py-3 hover:bg-gray-50 border-b text-sm">
                                üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                            <button onclick="clearAllData(); toggleMobileMenu()" class="w-full text-left px-4 py-3 hover:bg-red-50 text-red-600 rounded-b-lg text-sm">
                                üóëÔ∏è ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-8">
            <div class="flex space-x-2 sm:space-x-4 lg:space-x-8 py-3 sm:py-4 overflow-x-auto">
                <button onclick="showSection('dashboard')" class="nav-btn text-blue-600 border-b-2 border-blue-600 pb-2 font-medium whitespace-nowrap text-sm sm:text-base">
                    <span class="hidden sm:inline">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</span>
                    <span class="sm:hidden">üìä</span>
                </button>
                <button onclick="showSection('report')" class="nav-btn text-gray-500 hover:text-blue-600 pb-2 font-medium transition-colors whitespace-nowrap text-sm sm:text-base">
                    <span class="hidden sm:inline">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</span>
                    <span class="sm:hidden">üìù</span>
                </button>
                <button onclick="showSection('manage')" class="nav-btn text-gray-500 hover:text-blue-600 pb-2 font-medium transition-colors whitespace-nowrap text-sm sm:text-base">
                    <span class="hidden sm:inline">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</span>
                    <span class="sm:hidden">‚öôÔ∏è</span>
                </button>
                <button onclick="showSection('history')" class="nav-btn text-gray-500 hover:text-blue-600 pb-2 font-medium transition-colors whitespace-nowrap text-sm sm:text-base">
                    <span class="hidden sm:inline">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</span>
                    <span class="sm:hidden">üìö</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-3 sm:px-4 lg:px-8 py-4 sm:py-6 lg:py-8">
        <!-- Dashboard Section -->
        <div id="dashboard-section" class="section fade-in">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8">
                <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 lg:p-6 border-l-4 border-yellow-500">
                    <div class="flex items-center">
                        <div class="bg-yellow-100 p-2 sm:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 sm:w-6 sm:h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-2 sm:ml-4 min-w-0">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900" id="pending-count">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 lg:p-6 border-l-4 border-blue-500">
                    <div class="flex items-center">
                        <div class="bg-blue-100 p-2 sm:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 sm:w-6 sm:h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <div class="ml-2 sm:ml-4 min-w-0">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900" id="progress-count">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 lg:p-6 border-l-4 border-green-500">
                    <div class="flex items-center">
                        <div class="bg-green-100 p-2 sm:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 sm:w-6 sm:h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <div class="ml-2 sm:ml-4 min-w-0">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</p>
                            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900" id="completed-count">0</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white rounded-xl shadow-lg p-3 sm:p-4 lg:p-6 border-l-4 border-red-500">
                    <div class="flex items-center">
                        <div class="bg-red-100 p-2 sm:p-3 rounded-full flex-shrink-0">
                            <svg class="w-4 h-4 sm:w-6 sm:h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </div>
                        <div class="ml-2 sm:ml-4 min-w-0">
                            <p class="text-xs sm:text-sm font-medium text-gray-600 truncate">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</p>
                            <p class="text-lg sm:text-xl lg:text-2xl font-bold text-gray-900" id="cancelled-count">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Time Summary -->
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8">
                <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6">‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h2>
                <div id="time-summary" class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6">
                    <!-- Time summary will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Reports -->
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-bold text-gray-900 mb-4 sm:mb-6">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h2>
                <div id="recent-reports" class="space-y-3 sm:space-y-4">
                    <!-- Reports will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Report Section -->
        <div id="report-section" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 lg:p-8">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-6">üõ† ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</h2>
                <form id="repair-form" class="space-y-4 sm:space-y-6">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">üó∫ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</label>
                            <div class="flex gap-2">
<select id="machine-name" required
  class="flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
  <option value="" disabled selected>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
  <option value="SKIVING">SKIVING</option>
  <option value="GULE">GULE</option>
  <option value="WAREHOUSE">WAREHOUSE</option>
  <option value="FB-RH-J72A">FB-RH-J72A</option>
  <option value="FB-LH-J72A">FB-LH-J72A</option>
  <option value="FC-RH-J72A">FC-RH-J72A</option>
  <option value="FC-LH-J72A">FC-LH-J72A</option>
  <option value="RB-RH-J72A">RB-RH-J72A</option>
  <option value="RB-LH-J72A">RB-LH-J72A</option>
  <option value="RC-10X-J72A">RC-10X-J72A</option>
  <option value="FB-J03M">FB-J03M</option>
  <option value="FC-J03M">FC-J03M</option>
  <option value="RB-J03M">RB-J03M</option>
  <option value="RC-J03M">RC-J03M</option>
  <option value="ISO-FIX">ISO-FIX</option>
    
</select>
</div>
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">üëá‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</label>
                            <div class="flex gap-2"><input type="text" id="machine-code" class="flex-1 px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base" inputmode="numeric" pattern="[0-9]*" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç ‡πÄ‡∏ä‡πà‡∏ô 1234"></div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üè≠‡πÅ‡∏ú‡∏ô‡∏Å *</label>
                            <select id="department" required class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                                <option value="production">‚úÇSupply</option>
                                <option value="production">üëó‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï Sewing</option>
                                <option value="maintenance">‚öô‡πÅ‡∏ú‡∏ô‡∏Å‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</option>
                                <option value="quality">üëì‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</option>
                                <option value="warehouse">üì±‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                                <option value="office">üíª‡πÅ‡∏ú‡∏ô‡∏Å‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üö¶‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô *</label>
                            <select id="priority" required class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
                                <option value="low">üîµ‡∏ï‡πà‡∏≥</option>
                                <option value="medium">üü¢‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                                <option value="high">üü°‡∏™‡∏π‡∏á</option>
                                <option value="urgent">üî¥‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</option>
                            </select>
                        </div>
                        <div class="lg:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">üôç‚Äç‚ôÇÔ∏è‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á *</label>
                            <input type="text" id="reporter" required class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">üë®‚Äçüíª‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ *</label>
                        <textarea id="problem-description" required rows="4" class="w-full px-3 sm:px-4 py-2 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô"></textarea>
                    </div>
                    <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-4">
                        <button type="button" onclick="resetForm()" class="px-4 sm:px-6 py-2 sm:py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors text-sm sm:text-base">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                        <button type="submit" class="px-4 sm:px-6 py-2 sm:py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors shadow-lg text-sm sm:text-base">
                            ‡∏™‡πà‡∏á‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Manage Section -->
        <div id="manage-section" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 sm:mb-6 space-y-3 sm:space-y-0">
                    <h2 class="text-xl sm:text-2xl font-bold text-gray-900">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</h2>
                    <div class="w-full sm:w-auto">
                        <select id="status-filter" onchange="filterReports()" class="w-full sm:w-auto px-3 sm:px-4 py-2 border border-gray-300 rounded-lg text-sm sm:text-base">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                            <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="progress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                            <option value="cancelled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                        </select>
                    </div>
                </div>
                <div id="manage-reports" class="space-y-3 sm:space-y-4">
                    <!-- Management reports will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- History Section -->
        <div id="history-section" class="section hidden">
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-6">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h2>
                <div id="history-reports" class="space-y-3 sm:space-y-4">
                    <!-- History reports will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 sm:p-8 max-w-md w-full mx-auto text-center">
            <div class="bg-green-100 p-3 sm:p-4 rounded-full w-12 h-12 sm:w-16 sm:h-16 mx-auto mb-4">
                <svg class="w-6 h-6 sm:w-8 sm:h-8 text-green-600 mx-auto mt-0.5 sm:mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            </div>
            <h3 class="text-lg sm:text-xl font-bold text-gray-900 mb-2">‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <p class="text-sm sm:text-base text-gray-600 mb-6">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°: <span id="repair-id" class="font-bold text-blue-600"></span></p>
            <button onclick="closeModal()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-medium text-sm sm:text-base w-full sm:w-auto">
                ‡∏ï‡∏Å‡∏•‡∏á
            </button>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-2 sm:p-4">
        <div class="bg-white rounded-xl p-4 sm:p-6 lg:p-8 max-w-4xl w-full mx-auto max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h3>
                <button onclick="closeEditModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <form id="edit-form" class="space-y-6">
                <input type="hidden" id="edit-id">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á *</label>
                        <input type="text" id="edit-machine-name" disabled required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£</label>
                        <input type="text" id="edit-machine-code" disabled class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÅ‡∏ú‡∏ô‡∏Å *</label>
                        <select id="edit-department" disabled required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                            <option value="production">‚úÇ‡πÅ‡∏ú‡∏ô‡∏Å Supply</option>
                            <option value="production">üëó‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï Sewing</option>
                            <option value="maintenance">‚öô‡πÅ‡∏ú‡∏ô‡∏Å‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</option>
                            <option value="quality">üëì‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</option>
                            <option value="warehouse">üì≥‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            <option value="office">üíª‡πÅ‡∏ú‡∏ô‡∏Å‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô *</label>
                        <select id="edit-priority" disabled required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö</option>
                            <option value="low">üîµ‡∏ï‡πà‡∏≥</option>
                            <option value="medium">üü¢‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="high">üü°‡∏™‡∏π‡∏á</option>
                            <option value="urgent">üî¥‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á *</label>
                        <input type="text" id="edit-reporter" disabled required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
                        <input type="tel" id="edit-phone" disabled class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                        <select id="edit-status" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="pending">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="progress">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                            <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                            <option value="cancelled">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</label>
                        <select id="edit-assigned-to" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏¥‡∏™‡∏£‡∏∞">‡∏ô‡∏≤‡∏¢‡∏≠‡∏¥‡∏™‡∏£‡∏∞</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏ß‡∏á‡∏®‡πå">‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏ß‡∏á‡∏®‡πå</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏µ‡∏î‡∏≤">‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏µ‡∏î‡∏≤</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏£‡∏∏‡∏ä‡∏≤">‡∏ô‡∏≤‡∏¢‡∏≠‡∏£‡∏∏‡∏ä‡∏≤</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏î‡∏¥‡πÄ‡∏£‡∏Å">‡∏ô‡∏≤‡∏¢‡∏≠‡∏î‡∏¥‡πÄ‡∏£‡∏Å</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏">‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏±‡∏¢">‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏±‡∏¢</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏ä‡∏±‡∏¢">‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏ä‡∏±‡∏¢</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</label>
                        <select id="edit-approved-by" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
                            <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å Supply">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å Supply</option>
                            <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å Sewing">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å Sewing</option>
                            <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å Warehouse">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å Warehouse</option>
                            <option value="‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á">‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ú‡∏ô‡∏Å‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</option>
                            <option value="‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</option>
                            <option value="‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤</option>
                            <option value="‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£">‡∏ú‡∏π‡πâ‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£</option>
                        </select>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <h5 class="font-medium text-blue-900 mb-2">üìÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ß‡∏•‡∏≤ (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-blue-700 font-medium">‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°:</span>
                                <div id="display-report-time" class="text-blue-900 mt-1">-</div>
                            </div>
                            <div>
                                <span class="text-blue-700 font-medium">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°:</span>
                                <div id="display-start-time" class="text-blue-900 mt-1">-</div>
                            </div>
                            <div>
                                <span class="text-blue-700 font-medium">‡πÄ‡∏ß‡∏•‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à:</span>
                                <div id="display-completed-time" class="text-blue-900 mt-1">-</div>
                            </div>
                            <div>
                                <span class="text-blue-700 font-medium">‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°:</span>
                                <div id="display-total-time" class="text-blue-900 mt-1 font-semibold">-</div>
                            </div>
                        </div>
                        <div class="mt-3 text-xs text-blue-600">
                            üí° ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏≠‡∏á
                        </div>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤ *</label>
                    <textarea id="edit-problem-description" disabled required rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</label>
                    <div id="parts-container" class="space-y-3 mb-4">
                        <!-- Parts will be added dynamically -->
                    </div>
                    <button type="button" onclick="addPartField()" class="px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-lg text-sm font-medium transition-colors">
                        + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà
                    </button>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
                    <textarea id="edit-notes" required rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"></textarea>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeEditModal()" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition-colors">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button id="edit-save-btn" type="submit" class="px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium transition-colors shadow-lg opacity-50 cursor-not-allowed" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                
        <p id="edit-req-hint" class="mt-3 text-sm text-red-600 hidden">
            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å <span class="font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>, <span class="font-semibold">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</span>, <span class="font-semibold">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</span> ‡πÅ‡∏•‡∏∞ <span class="font-semibold">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </p>
                </div>
            </form>
    
        </div>
    </div>

    <!-- Assign Modal -->
    <div id="assign-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-900">‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
                <button onclick="closeAssignModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <form id="assign-form">
                <input type="hidden" id="assign-id">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö *</label>
                    <select id="assign-technician" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏≤‡∏á</option>
                         <option value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏¥‡∏™‡∏£‡∏∞">‡∏ô‡∏≤‡∏¢‡∏≠‡∏¥‡∏™‡∏£‡∏∞</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏ß‡∏á‡∏®‡πå">‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏¥‡∏ß‡∏á‡∏®‡πå</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏µ‡∏î‡∏≤">‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏µ‡∏î‡∏≤</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏£‡∏∏‡∏ä‡∏≤">‡∏ô‡∏≤‡∏¢‡∏≠‡∏£‡∏∏‡∏ä‡∏≤</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏≠‡∏î‡∏¥‡πÄ‡∏£‡∏Å">‡∏ô‡∏≤‡∏¢‡∏≠‡∏î‡∏¥‡πÄ‡∏£‡∏Å</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏">‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤‡∏¢‡∏∏</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏±‡∏¢">‡∏ô‡∏≤‡∏¢‡∏ì‡∏±‡∏ê‡∏î‡∏ô‡∏±‡∏¢</option>
                            <option value="‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏ä‡∏±‡∏¢">‡∏ô‡∏≤‡∏¢‡∏™‡∏∏‡∏£‡∏ä‡∏±‡∏¢</option>
                    </select>
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea id="assign-notes" rows="3" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢"></textarea>
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" onclick="closeAssignModal()" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                    <button type="submit" class="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium">
                        ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢
                    </button>
                
        <p id="edit-req-hint" class="mt-3 text-sm text-red-600 hidden">
            ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å <span class="font-semibold">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>, <span class="font-semibold">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö</span>, <span class="font-semibold">‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏õ‡∏¥‡∏î‡∏á‡∏≤‡∏ô</span> ‡πÅ‡∏•‡∏∞ <span class="font-semibold">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ / ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span> ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        </p>
                </div>
            </form>
    
        </div>
    </div>

    <!-- Time Log Modal -->
    <div id="timelog-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-4xl mx-4 max-h-screen overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold text-gray-900">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô</h3>
                <button onclick="closeTimeLogModal()" class="text-gray-400 hover:text-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="timelog-content" class="space-y-4">
                <!-- Time log entries will be populated here -->
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl p-8 max-w-md mx-4 text-center">
            <div class="bg-red-100 p-4 rounded-full w-16 h-16 mx-auto mb-4">
                <svg class="w-8 h-8 text-red-600 mx-auto mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
            <p class="text-gray-600 mb-6">‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° <span id="delete-id" class="font-bold text-red-600"></span> ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
            <div class="flex justify-center space-x-4">
                <button onclick="closeDeleteModal()" class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button onclick="confirmDelete()" class="px-6 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg font-medium">
                    ‡∏•‡∏ö
                </button>
            </div>
        </div>
    </div>

    <script>
// === Google Apps Script API integration ===
const API_URL = 'https://script.google.com/macros/s/AKfycbz6338bRXb9_Psg3qf7WnDIgXRvDbhEz6ImhGimzLKFcWXXjZ4rOSBGkkiNASRgRGC3MQ/exec';

/** Send UPSERT report + optional new logs */
async function gasUpsert(report, newLogs) {
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      body: JSON.stringify({
        type: 'UPSERT_REPORT',
        report,
        newLogs: Array.isArray(newLogs) ? newLogs : []
      })
    });
  } catch (err) { console.error('GAS upsert error:', err); }
}

async function gasDelete(id) {
  try {
    await fetch(API_URL, {
      method: 'POST',
      mode: 'no-cors',
      body: JSON.stringify({ type: 'DELETE_REPORT', id })
    });
  } catch (err) { console.error('GAS delete error:', err); }
}
// === end GAS integration ===
// === ID generator (collision-proof across users) ===
function generateUniqueId() {
  // RP + yyyymmddHHMMSS + 3 random digits
  const d = new Date();
  const ymdhms = d.toISOString().replace(/[-:TZ.]/g,'').slice(0,14);
  const rand = Math.floor(Math.random()*1000).toString().padStart(3,'0');
  return 'RP' + ymdhms + rand;
}
// === end ID generator ===


        // Sample data - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡∏•‡πà‡∏≤
        let repairReports = [];
        let nextId = 1;

        // Local Storage Functions
        function saveToLocalStorage() {
            try {
                const data = {
                    repairReports: repairReports,
                    nextId: nextId,
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem('repairSystemData', JSON.stringify(data));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('repairSystemData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    repairReports = data.repairReports || [];
                    nextId = data.nextId || 1;
                    
                    // Show welcome message with loaded data count
                    if (repairReports.length > 0) {
                        showWelcomeMessage(repairReports.length, data.lastSaved);
                    }
                    
                    return true;
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
                // Reset to default if corrupted
                repairReports = [];
                nextId = 1;
            }
            return false;
        }

        function showWelcomeMessage(count, lastSaved) {
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'fixed top-4 right-4 bg-blue-500 text-white px-6 py-4 rounded-lg shadow-lg z-50 transform transition-all duration-500';
            welcomeDiv.innerHTML = `
                <div class="flex items-center space-x-3">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <div>
                        <div class="font-semibold">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤!</div>
                        <div class="text-sm opacity-90">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</div>
                        <div class="text-xs opacity-75">‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${formatDateTime(lastSaved)}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(welcomeDiv);
            
            setTimeout(() => {
                welcomeDiv.style.transform = 'translateX(100%)';
                setTimeout(() => welcomeDiv.remove(), 500);
            }, 4000);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data first
            loadFromLocalStorage();
            
            showSection('dashboard');
            updateDashboard();
            renderRecentReports();
            renderManageReports();
            renderHistoryReports();
        });

        // Navigation
        function showSection(section) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(section + '-section').classList.remove('hidden');
            
            // Update navigation
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-blue-600', 'border-b-2', 'border-blue-600');
                btn.classList.add('text-gray-500');
            });
            
            // Find and update the clicked button
            const buttons = document.querySelectorAll('.nav-btn');
            const sectionMap = ['dashboard', 'report', 'manage', 'history'];
            const index = sectionMap.indexOf(section);
            
            if (index !== -1 && buttons[index]) {
                buttons[index].classList.remove('text-gray-500');
                buttons[index].classList.add('text-blue-600', 'border-b-2', 'border-blue-600');
            }
        }

        // Form handling
        document.getElementById('repair-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const now = new Date();
            const formData = {
                id: generateUniqueId(),
                machineName: document.getElementById('machine-name').value,
                machineCode: formatMachineCode(document.getElementById("machine-code").value),
                department: document.getElementById('department').value,
                priority: document.getElementById('priority').value,
                reporter: document.getElementById('reporter').value,
                problem: document.getElementById('problem-description').value,
                status: 'pending',
                date: now.toISOString().split('T')[0],
                reportTime: now.toISOString(), // ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏° (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
                startTime: null, // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏° (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô progress)
                completedTime: null, // ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô completed)
                totalRepairTime: null, // ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°
                assignedTo: '',
                notes: '',
                approvedBy: '',
                parts: [],
                timeLog: [
                    { 
                        action: '‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°', 
                        timestamp: now.toISOString(), 
                        user: document.getElementById('reporter').value, 
                        details: `‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ${document.getElementById('problem-description').value.substring(0, 50)}${document.getElementById('problem-description').value.length > 50 ? '...' : ''} - ‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á: ${formatDateTime(now.toISOString())}`,
                        autoTime: true
                    }
                ]
            };
            
            repairReports.unshift(formData);
            nextId++;
            
            // Save to localStorage
            saveToLocalStorage();
            
            
            // Sync to Google Sheets
            gasUpsert(formData, formData.timeLog);
            // Show success modal
            document.getElementById('repair-id').textContent = formData.id;
            document.getElementById('success-modal').classList.remove('hidden');
            document.getElementById('success-modal').classList.add('flex');
            
            // Reset form
            resetForm();
            
            // Update displays
            updateDashboard();
            renderRecentReports();
            renderManageReports();
            renderHistoryReports();
        });

        function resetForm() {
            document.getElementById('repair-form').reset();
        }

        function closeModal() {
            document.getElementById('success-modal').classList.add('hidden');
            document.getElementById('success-modal').classList.remove('flex');
            showSection('dashboard');
        }

        // Dashboard updates
        function updateDashboard() {
            const counts = {
                pending: repairReports.filter(r => r.status === 'pending').length,
                progress: repairReports.filter(r => r.status === 'progress').length,
                completed: repairReports.filter(r => r.status === 'completed').length,
                cancelled: repairReports.filter(r => r.status === 'cancelled').length
            };
            
            document.getElementById('pending-count').textContent = counts.pending;
            document.getElementById('progress-count').textContent = counts.progress;
            document.getElementById('completed-count').textContent = counts.completed;
            document.getElementById('cancelled-count').textContent = counts.cancelled;
            
            // Update time summary
            updateTimeSummary();
        }

        function updateTimeSummary() {
            const completedReports = repairReports.filter(r => r.status === 'completed' && r.completedTime);
            const ongoingReports = repairReports.filter(r => r.status === 'progress');
            
            let avgRepairTime = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            let fastestRepair = '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            let currentOngoing = ongoingReports.length;
            
            if (completedReports.length > 0) {
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ô‡∏≤‡∏ó‡∏µ)
                const totalMinutes = completedReports.reduce((sum, report) => {
                    const startTime = report.startTime || report.reportTime;
                    return sum + calculateMinutes(startTime, report.completedTime);
                }, 0);
                const avgMinutes = Math.round(totalMinutes / completedReports.length);
                avgRepairTime = formatMinutesToDuration(avgMinutes);
                
                // ‡∏´‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                const fastestMinutes = Math.min(...completedReports.map(report => {
                    const startTime = report.startTime || report.reportTime;
                    return calculateMinutes(startTime, report.completedTime);
                }));
                fastestRepair = formatMinutesToDuration(fastestMinutes);
            }
            
            const summaryContainer = document.getElementById('time-summary');
            summaryContainer.innerHTML = `
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600 mb-2">${avgRepairTime}</div>
                    <div class="text-sm text-blue-800">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</div>
                    <div class="text-xs text-blue-600 mt-1">${completedReports.length} ‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-600 mb-2">${fastestRepair}</div>
                    <div class="text-sm text-green-800">‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                    <div class="text-xs text-green-600 mt-1">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded-lg">
                    <div class="text-2xl font-bold text-orange-600 mb-2">${currentOngoing}</div>
                    <div class="text-sm text-orange-800">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
                    <div class="text-xs text-orange-600 mt-1">‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</div>
                </div>
            `;
        }

        function calculateMinutes(startTime, endTime) {
            if (!startTime || !endTime) return 0;
            const start = new Date(startTime);
            const end = new Date(endTime);
            return Math.floor((end - start) / (1000 * 60));
        }

        function formatMinutesToDuration(minutes) {
            if (minutes < 60) {
                return `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
            } else if (minutes < 1440) { // less than 24 hours
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = minutes % 60;
                return `${hours} ‡∏ä‡∏°.${remainingMinutes > 0 ? ` ${remainingMinutes} ‡∏ô‡∏≤‡∏ó‡∏µ` : ''}`;
            } else {
                const days = Math.floor(minutes / 1440);
                const remainingHours = Math.floor((minutes % 1440) / 60);
                return `${days} ‡∏ß‡∏±‡∏ô${remainingHours > 0 ? ` ${remainingHours} ‡∏ä‡∏°.` : ''}`;
            }
        }

        function renderRecentReports() {
            const container = document.getElementById('recent-reports');
            const recent = repairReports.slice(0, 5);
            
            if (recent.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="bg-gray-100 p-4 rounded-full w-16 h-16 mx-auto mb-4">
                            <svg class="w-8 h-8 text-gray-400 mx-auto mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°</h3>
                        <p class="text-gray-600 mb-4">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</p>
                        <button onclick="showSection('report')" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            + ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = recent.map(report => `
                <div class="border border-gray-200 rounded-lg p-3 sm:p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1 min-w-0">
                            <div class="flex flex-wrap items-center gap-2 mb-2">
                                <span class="font-bold text-blue-600 text-sm sm:text-base">${report.id}</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(report.status)}">${getStatusText(report.status)}</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getPriorityClass(report.priority)}">${getPriorityText(report.priority)}</span>
                            </div>
                            <h3 class="font-semibold text-gray-900 mb-1 text-sm sm:text-base truncate">${report.machineName}</h3>
                            <p class="text-gray-600 text-xs sm:text-sm mb-2 line-clamp-2">${report.problem}</p>
                            <div class="flex flex-col sm:flex-row sm:items-center text-xs sm:text-sm text-gray-500 space-y-1 sm:space-y-0 sm:space-x-4">
                                <span class="truncate">üìÖ ${formatDateTime(report.reportTime)}</span>
                                <span class="truncate">üë§ ${report.reporter}</span>
                                <span class="truncate">üè¢ ${getDepartmentText(report.department)}</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderManageReports() {
            const container = document.getElementById('manage-reports');
            const filter = document.getElementById('status-filter')?.value || '';
            const filtered = filter ? repairReports.filter(r => r.status === filter) : repairReports;
            
            if (filtered.length === 0) {
                const message = filter ? 
                    `‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "${getStatusText(filter)}"` : 
                    '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="bg-gray-100 p-4 rounded-full w-16 h-16 mx-auto mb-4">
                            <svg class="w-8 h-8 text-gray-400 mx-auto mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">${message}</h3>
                        <p class="text-gray-600 mb-4">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</p>
                        <button onclick="showSection('report')" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            + ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(report => `
                <div class="border border-gray-200 rounded-lg p-3 sm:p-4 lg:p-6 hover:shadow-md transition-shadow">
                    <div class="flex flex-col lg:flex-row lg:justify-between lg:items-start mb-4 space-y-4 lg:space-y-0">
                        <div class="flex-1 min-w-0">
                            <div class="flex flex-wrap items-center gap-2 mb-3">
                                <span class="font-bold text-blue-600 text-base sm:text-lg">${report.id}</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getStatusClass(report.status)}">${getStatusText(report.status)}</span>
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${getPriorityClass(report.priority)}">${getPriorityText(report.priority)}</span>
                            </div>
                            <h3 class="font-semibold text-gray-900 text-base sm:text-lg mb-2 break-words">${report.machineName} (${report.machineCode || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'})</h3>
                            <p class="text-gray-600 mb-3 text-sm sm:text-base break-words">${report.problem}</p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-4 text-xs sm:text-sm text-gray-600">
                                <div class="truncate">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á: ${formatDateTime(report.reportTime)}</div>
                                <div class="truncate">üë§ ‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á: ${report.reporter}</div>
                                <div class="truncate">üè¢ ‡πÅ‡∏ú‡∏ô‡∏Å: ${getDepartmentText(report.department)}</div>
                                ${report.startTime ? `<div class="truncate">üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°: ${formatDateTime(report.startTime)}</div>` : ''}
                                ${report.completedTime ? `<div class="truncate">‚úÖ ‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à: ${formatDateTime(report.completedTime)}</div>` : ''}
                                ${report.status === 'completed' && report.completedTime ? `<div class="col-span-1 sm:col-span-2"><span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°: ${calculateDuration(report.startTime || report.reportTime, report.completedTime)}</span></div>` : ''}
                            </div>
                            ${report.assignedTo ? `<div class="mt-2 text-xs sm:text-sm text-blue-600 truncate">üîß ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö: ${report.assignedTo}</div>` : ''}
                            ${report.approvedBy ? `<div class="mt-2 text-xs sm:text-sm text-green-600 truncate">‚úÖ ‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥: ${report.approvedBy}</div>` : ''}
                            ${report.parts && report.parts.length > 0 ? `<div class="mt-2 text-xs sm:text-sm text-purple-600 break-words">üîß ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà: ${report.parts.map(p => `${p.name} (${p.quantity} ‡∏ä‡∏¥‡πâ‡∏ô)`).join(', ')}</div>` : ''}
                            ${report.notes ? `<div class="mt-2 text-xs sm:text-sm text-gray-600 break-words">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ${report.notes}</div>` : ''}
                        </div>
                        <div class="flex flex-row lg:flex-col space-x-2 lg:space-x-0 lg:space-y-2 lg:ml-4 overflow-x-auto lg:overflow-x-visible">
                            <select onchange="updateStatus('${report.id}', this.value)" class="px-2 py-1 lg:px-3 lg:py-2 border border-gray-300 rounded text-xs lg:text-sm whitespace-nowrap flex-shrink-0">
                                <option value="pending" ${report.status === 'pending' ? 'selected' : ''}>‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                <option value="progress" ${report.status === 'progress' ? 'selected' : ''}>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</option>
                                <option value="completed" ${report.status === 'completed' ? 'selected' : ''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
                                <option value="cancelled" ${report.status === 'cancelled' ? 'selected' : ''}>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                            </select>
                            <button onclick="editReport('${report.id}')" class="px-2 py-1 lg:px-3 lg:py-2 bg-blue-500 text-white rounded text-xs lg:text-sm hover:bg-blue-600 transition-colors whitespace-nowrap flex-shrink-0">
                                <span class="lg:hidden">‚úèÔ∏è</span>
                                <span class="hidden lg:inline">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</span>
                            </button>
                            <button onclick="assignTechnician('${report.id}')" class="px-2 py-1 lg:px-3 lg:py-2 bg-green-500 text-white rounded text-xs lg:text-sm hover:bg-green-600 transition-colors whitespace-nowrap flex-shrink-0">
                                <span class="lg:hidden">üë§</span>
                                <span class="hidden lg:inline">üë§ ‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</span>
                            </button>
                            <button onclick="viewTimeLog('${report.id}')" class="px-2 py-1 lg:px-3 lg:py-2 bg-purple-500 text-white rounded text-xs lg:text-sm hover:bg-purple-600 transition-colors whitespace-nowrap flex-shrink-0">
                                <span class="lg:hidden">‚è∞</span>
                                <span class="hidden lg:inline">‚è∞ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</span>
                            </button>
                            <button onclick="deleteReport('${report.id}')" class="px-2 py-1 lg:px-3 lg:py-2 bg-red-500 text-white rounded text-xs lg:text-sm hover:bg-red-600 transition-colors whitespace-nowrap flex-shrink-0">
                                <span class="lg:hidden">üóëÔ∏è</span>
                                <span class="hidden lg:inline">üóëÔ∏è ‡∏•‡∏ö</span>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderHistoryReports() {
            const container = document.getElementById('history-reports');
            const completed = repairReports.filter(r => r.status === 'completed' || r.status === 'cancelled');
            
            if (completed.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="bg-gray-100 p-4 rounded-full w-16 h-16 mx-auto mb-4">
                            <svg class="w-8 h-8 text-gray-400 mx-auto mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-lg font-medium text-gray-900 mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h3>
                        <p class="text-gray-600 mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß</p>
                        <button onclick="showSection('report')" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">
                            + ‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = completed.map(report => `
                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center space-x-3 mb-2">
                                <span class="font-bold text-blue-600">${report.id}</span>
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${getStatusClass(report.status)}">${getStatusText(report.status)}</span>
                                <span class="px-3 py-1 rounded-full text-sm font-medium ${getPriorityClass(report.priority)}">${getPriorityText(report.priority)}</span>
                            </div>
                            <h3 class="font-semibold text-gray-900 mb-1">${report.machineName}</h3>
                            <p class="text-gray-600 text-sm mb-2">${report.problem}</p>
                            <div class="flex items-center text-sm text-gray-500 space-x-4 flex-wrap">
                                <span>üìÖ ‡πÅ‡∏à‡πâ‡∏á: ${formatDateTime(report.reportTime)}</span>
                                ${report.startTime ? `<span>üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°: ${formatDateTime(report.startTime)}</span>` : ''}
                                ${report.completedTime ? `<span>‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à: ${formatDateTime(report.completedTime)}</span>` : ''}
                                <span>üë§ ${report.reporter}</span>
                                <span>üè¢ ${getDepartmentText(report.department)}</span>
                                ${report.assignedTo ? `<span>üîß ${report.assignedTo}</span>` : ''}
                                ${report.approvedBy ? `<span>‚úÖ ${report.approvedBy}</span>` : ''}
                            </div>
                            ${report.status === 'completed' && report.completedTime ? `<div class="mt-2"><span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">‚è±Ô∏è ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${calculateDuration(report.startTime || report.reportTime, report.completedTime)}</span></div>` : ''}
                            ${report.parts && report.parts.length > 0 ? `<div class="mt-2 text-sm text-purple-600">üîß ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà: ${report.parts.map(p => `${p.name} (${p.quantity} ‡∏ä‡∏¥‡πâ‡∏ô)`).join(', ')}</div>` : ''}
                            ${report.notes ? `<div class="mt-2 text-sm text-gray-600">üìù ${report.notes}</div>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Utility functions
        function updateStatus(id, newStatus) {
            const report = repairReports.find(r => r.id === id);
            if (report) {
                const oldStatus = report.status;
                report.status = newStatus;
                
                // Add time log entry with automatic timestamp
                const now = new Date().toISOString();
                const statusText = getStatusText(newStatus);
                
                if (newStatus === 'progress' && !report.startTime) {
                    // ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°
                    report.startTime = now;
                    report.timeLog.push({
                        action: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°',
                        timestamp: now,
                        user: '‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥',
                        details: `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏° - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°: ${formatDateTime(now)}`,
                        autoTime: true
                    });
                } else if (newStatus === 'completed') {
                    if (!report.completedTime) {
                        // ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                        report.completedTime = now;
                        
                        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° (‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°)
                        const startTime = report.startTime || report.reportTime;
                        if (startTime) {
                            report.totalRepairTime = calculateDuration(startTime, report.completedTime);
                        }
                        
                        report.timeLog.push({
                            action: '‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à',
                            timestamp: now,
                            user: '‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥',
                            details: `‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à: ${formatDateTime(now)}${report.totalRepairTime ? ` | ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°: ${report.totalRepairTime}` : ''}`,
                            autoTime: true
                        });
                    }
                } else if (newStatus === 'cancelled') {
                    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    report.timeLog.push({
                        action: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô',
                        timestamp: now,
                        user: '‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥',
                        details: `‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° - ‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å: ${formatDateTime(now)}`,
                        autoTime: true
                    });
                } else {
                    report.timeLog.push({
                        action: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                        timestamp: now,
                        user: '‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥',
                        details: `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å "${getStatusText(oldStatus)}" ‡πÄ‡∏õ‡πá‡∏ô "${statusText}" - ‡πÄ‡∏ß‡∏•‡∏≤: ${formatDateTime(now)}`,
                        autoTime: true
                    });
                }
                
                // Save to localStorage
                saveToLocalStorage();
                
                
                // Sync status change to Google Sheets
                (function(){ const lastLog = (report.timeLog && report.timeLog[report.timeLog.length-1]) || null; gasUpsert(report, lastLog ? [lastLog] : []); })();
                updateDashboard();
                renderRecentReports();
                renderManageReports();
                renderHistoryReports();
            }
        }

        function viewTimeLog(id) {
            const report = repairReports.find(r => r.id === id);
            if (!report) return;
            
            const content = document.getElementById('timelog-content');
            content.innerHTML = `
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h4 class="font-bold text-lg text-blue-900 mb-2">${report.id} - ${report.machineName}</h4>
                    <p class="text-blue-700">${report.problem}</p>
                    <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                        <div><strong>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á:</strong> ${report.reporter}</div>
                        <div><strong>‡πÅ‡∏ú‡∏ô‡∏Å:</strong> ${getDepartmentText(report.department)}</div>
                        <div><strong>‡∏£‡∏∞‡∏î‡∏±‡∏ö:</strong> ${getPriorityText(report.priority)}</div>
                        ${report.assignedTo ? `<div><strong>‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö:</strong> ${report.assignedTo}</div>` : ''}
                        ${report.startTime && report.completedTime ? `<div><strong>‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${calculateDuration(report.startTime, report.completedTime)}</div>` : ''}
                        <div><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> <span class="px-2 py-1 rounded text-xs ${getStatusClass(report.status)}">${getStatusText(report.status)}</span></div>
                    </div>
                </div>
                
                <div class="space-y-3">
                    ${report.timeLog.map((log, index) => `
                        <div class="flex items-start space-x-4 p-4 ${log.autoTime ? 'bg-blue-50 border-l-4 border-blue-400' : 'bg-gray-50'} rounded-lg">
                            <div class="flex-shrink-0 w-12 h-12 ${log.autoTime ? 'bg-blue-100' : 'bg-gray-100'} rounded-full flex items-center justify-center">
                                ${log.autoTime ? 
                                    '<svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>' :
                                    `<span class="text-gray-600 font-bold text-sm">${index + 1}</span>`
                                }
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h5 class="font-semibold ${log.autoTime ? 'text-blue-900' : 'text-gray-900'}">${log.action}</h5>
                                    <span class="text-sm ${log.autoTime ? 'text-blue-600' : 'text-gray-500'}">${formatDateTime(log.timestamp)}</span>
                                    ${log.autoTime ? '<span class="px-2 py-1 bg-blue-200 text-blue-800 text-xs rounded-full">‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</span>' : ''}
                                </div>
                                <p class="${log.autoTime ? 'text-blue-700' : 'text-gray-700'} mb-1">${log.details}</p>
                                <p class="text-sm ${log.autoTime ? 'text-blue-600' : 'text-blue-600'}">‡πÇ‡∏î‡∏¢: ${log.user}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            document.getElementById('timelog-modal').classList.remove('hidden');
            document.getElementById('timelog-modal').classList.add('flex');
        }

        function closeTimeLogModal() {
            document.getElementById('timelog-modal').classList.add('hidden');
            document.getElementById('timelog-modal').classList.remove('flex');
        }

        function editReport(id) {
            const report = repairReports.find(r => r.id === id);
            if (!report) return;
            
            // Fill edit form
            document.getElementById('edit-id').value = report.id;
            document.getElementById('edit-machine-name').value = report.machineName;
            document.getElementById('edit-machine-code').value = report.machineCode || '';
            document.getElementById('edit-department').value = report.department;
            document.getElementById('edit-priority').value = report.priority;
            document.getElementById('edit-reporter').value = report.reporter;
            document.getElementById('edit-phone').value = report.phone || '';
            document.getElementById('edit-status').value = report.status;
            document.getElementById('edit-assigned-to').value = report.assignedTo || '';
            document.getElementById('edit-approved-by').value = report.approvedBy || '';
            document.getElementById('edit-problem-description').value = report.problem;
            document.getElementById('edit-notes').value = report.notes || '';
            
            // Display time information (read-only)
            document.getElementById('display-report-time').textContent = formatDateTime(report.reportTime);
            document.getElementById('display-start-time').textContent = report.startTime ? formatDateTime(report.startTime) : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°';
            document.getElementById('display-completed-time').textContent = report.completedTime ? formatDateTime(report.completedTime) : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à';
            
            // Calculate and display total time
            if (report.completedTime && (report.startTime || report.reportTime)) {
                const startTime = report.startTime || report.reportTime;
                const totalTime = calculateDuration(startTime, report.completedTime);
                document.getElementById('display-total-time').textContent = totalTime;
            } else if (report.startTime) {
                const currentTime = new Date().toISOString();
                const elapsedTime = calculateDuration(report.startTime, currentTime);
                document.getElementById('display-total-time').textContent = `${elapsedTime} (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£)`;
            } else {
                document.getElementById('display-total-time').textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°';
            }
            
            // Load parts data
            loadPartsToForm(report.parts || []);
            
            // Show modal
            document.getElementById('edit-modal').classList.remove('hidden');
            document.getElementById('edit-modal').classList.add('flex');
        }

        function assignTechnician(id) {
            document.getElementById('assign-id').value = id;
            document.getElementById('assign-technician').value = '';
            document.getElementById('assign-notes').value = '';
            
            document.getElementById('assign-modal').classList.remove('hidden');
            document.getElementById('assign-modal').classList.add('flex');
        }

        function deleteReport(id) {
            document.getElementById('delete-id').textContent = id;
            window.deleteReportId = id;
            
            document.getElementById('delete-modal').classList.remove('hidden');
            document.getElementById('delete-modal').classList.add('flex');
        }

        function closeEditModal() {
            document.getElementById('edit-modal').classList.add('hidden');
            document.getElementById('edit-modal').classList.remove('flex');
        }

        function closeAssignModal() {
            document.getElementById('assign-modal').classList.add('hidden');
            document.getElementById('assign-modal').classList.remove('flex');
        }

        function closeDeleteModal() {
            document.getElementById('delete-modal').classList.add('hidden');
            document.getElementById('delete-modal').classList.remove('flex');
        }

        function confirmDelete() {
            const id = window.deleteReportId;
            const index = repairReports.findIndex(r => r.id === id);
            
            if (index !== -1) {
                repairReports.splice(index, 1);
                
                // Save to localStorage
                saveToLocalStorage();
                
                
                // Sync deletion to Google Sheets
                gasDelete(id);
                updateDashboard();
                renderRecentReports();
                renderManageReports();
                renderHistoryReports();
            }
            
            closeDeleteModal();
        }

        // Parts database
        const partsDatabase = [
            { name: '‡∏´‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå 3D', category: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå' },
            { name: '‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà 12V 100Ah', category: '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤' },
           
        ];

        // Parts management functions
        function addPartField() {
            const container = document.getElementById('parts-container');
            const partIndex = container.children.length;
            
            const partDiv = document.createElement('div');
            partDiv.className = 'border border-gray-200 rounded-lg p-4 bg-gray-50';
            partDiv.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <h4 class="font-medium text-gray-900">‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà ${partIndex + 1}</h4>
                    <button type="button" onclick="removePart(this)" class="text-red-500 hover:text-red-700">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="relative">
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà *</label>
                        <div class="relative">
                            <input type="text" class="part-name w-full px-3 py-2 pr-10 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                   placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." 
                                   oninput="filterParts(this)" 
                                   onfocus="showPartsList(this)"
                                   onblur="hidePartsList(this)"
                                   required>
                            <button type="button" onclick="togglePartsList(this)" class="absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="parts-dropdown absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-y-auto hidden">
                            <div class="p-2 border-b bg-gray-50">
                                <div class="text-xs text-gray-600 mb-2">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</div>
                                <div class="flex flex-wrap gap-1">
                                    <button type="button" onclick="filterByCategory(this, '')" class="category-btn px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                                    <button type="button" onclick="filterByCategory(this, '‡πÑ‡∏ü‡∏ü‡πâ‡∏≤')" class="category-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors">‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</button>
                                    <button type="button" onclick="filterByCategory(this, '‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå')" class="category-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå</button>
                                    <button type="button" onclick="filterByCategory(this, '‡∏•‡∏π‡∏Å‡∏õ‡∏∑‡∏ô')" class="category-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors">‡∏•‡∏π‡∏Å‡∏õ‡∏∑‡∏ô</button>
                                    <button type="button" onclick="filterByCategory(this, '‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô')" class="category-btn px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded hover:bg-gray-200 transition-colors">‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô</button>
                                </div>
                            </div>
                            <div class="parts-list">
                                ${generatePartsOptions()}
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô *</label>
                        <input type="number" class="part-quantity w-full px-3 py-2 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" min="1" value="1" required>
                    </div>
                </div>
            `;
            
            container.appendChild(partDiv);
        }

        function generatePartsOptions() {
            return partsDatabase.map(part => `
                <div class="part-option px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0" 
                     onclick="selectPart(this, '${part.name}')"
                     data-category="${part.category}"
                     data-name="${part.name.toLowerCase()}">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-gray-900 text-sm">${part.name}</div>
                            <div class="text-xs text-gray-500">${part.category}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterParts(input) {
            const dropdown = input.closest('.relative').querySelector('.parts-dropdown');
            const partsList = dropdown.querySelector('.parts-list');
            const searchTerm = input.value.toLowerCase();
            
            if (searchTerm.length === 0) {
                partsList.innerHTML = generatePartsOptions();
                return;
            }
            
            const filteredParts = partsDatabase.filter(part => 
                part.name.toLowerCase().includes(searchTerm) || 
                part.category.toLowerCase().includes(searchTerm)
            );
            
            partsList.innerHTML = filteredParts.map(part => `
                <div class="part-option px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0" 
                     onclick="selectPart(this, '${part.name}')"
                     data-category="${part.category}"
                     data-name="${part.name.toLowerCase()}">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-gray-900 text-sm">${part.name}</div>
                            <div class="text-xs text-gray-500">${part.category}</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            if (filteredParts.length === 0) {
                partsList.innerHTML = '<div class="px-3 py-4 text-center text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>';
            }
        }

        function filterByCategory(button, category) {
            const dropdown = button.closest('.parts-dropdown');
            const partsList = dropdown.querySelector('.parts-list');
            const input = dropdown.closest('.relative').querySelector('.part-name');
            
            // Update category button styles
            dropdown.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('bg-blue-100', 'text-blue-700');
                btn.classList.add('bg-gray-100', 'text-gray-700');
            });
            button.classList.remove('bg-gray-100', 'text-gray-700');
            button.classList.add('bg-blue-100', 'text-blue-700');
            
            // Filter parts by category
            const filteredParts = category ? 
                partsDatabase.filter(part => part.category === category) : 
                partsDatabase;
            
            partsList.innerHTML = filteredParts.map(part => `
                <div class="part-option px-3 py-2 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0" 
                     onclick="selectPart(this, '${part.name}')"
                     data-category="${part.category}"
                     data-name="${part.name.toLowerCase()}">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="font-medium text-gray-900 text-sm">${part.name}</div>
                            <div class="text-xs text-gray-500">${part.category}</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Clear search input
            input.value = '';
        }

        function selectPart(element, name) {
            const partDiv = element.closest('.border');
            const nameInput = partDiv.querySelector('.part-name');
            const dropdown = partDiv.querySelector('.parts-dropdown');
            
            nameInput.value = name;
            
            dropdown.classList.add('hidden');
            
            // Show success animation
            element.classList.add('bg-green-100');
            setTimeout(() => {
                element.classList.remove('bg-green-100');
            }, 300);
        }

        function showPartsList(input) {
            const dropdown = input.closest('.relative').querySelector('.parts-dropdown');
            dropdown.classList.remove('hidden');
        }

        function hidePartsList(input) {
            setTimeout(() => {
                const dropdown = input.closest('.relative').querySelector('.parts-dropdown');
                dropdown.classList.add('hidden');
            }, 200);
        }

        function togglePartsList(button) {
            const dropdown = button.closest('.relative').querySelector('.parts-dropdown');
            dropdown.classList.toggle('hidden');
        }

        function removePart(button) {
            button.closest('div.border').remove();
            updatePartNumbers();
        }

        function updatePartNumbers() {
            const container = document.getElementById('parts-container');
            const parts = container.children;
            
            for (let i = 0; i < parts.length; i++) {
                const title = parts[i].querySelector('h4');
                if (title) {
                    title.textContent = `‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà ${i + 1}`;
                }
            }
        }

        function loadPartsToForm(parts) {
            const container = document.getElementById('parts-container');
            container.innerHTML = '';
            
            if (parts && parts.length > 0) {
                parts.forEach(part => {
                    addPartField();
                    const lastPart = container.lastElementChild;
                    lastPart.querySelector('.part-name').value = part.name || '';
                    lastPart.querySelector('.part-quantity').value = part.quantity || 1;
                });
            }
        }

        function getPartsFromForm() {
            const container = document.getElementById('parts-container');
            const parts = [];
            
            Array.from(container.children).forEach(partDiv => {
                const name = partDiv.querySelector('.part-name').value.trim();
                const quantity = parseInt(partDiv.querySelector('.part-quantity').value) || 1;
                
                if (name) {
                    parts.push({ name, quantity });
                }
            });
            
            return parts;
        }

        // Edit form submission
        document.getElementById('edit-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('edit-id').value;
            const report = repairReports.find(r => r.id === id);
            
            if (report) {
                const __prevLen = (report.timeLog ? report.timeLog.length : 0);
                const oldStatus = report.status;
                const newStatus = document.getElementById('edit-status').value;
                const now = new Date().toISOString();
                if ((newStatus === 'progress' || newStatus === 'completed') && !report.startTime) { report.startTime = report.reportTime || now; }
                
                // Update allowed fields only (lock basic fields)
                report.assignedTo = document.getElementById('edit-assigned-to').value;
                report.approvedBy = document.getElementById('edit-approved-by').value;
                report.notes = document.getElementById('edit-notes').value;
                report.parts = getPartsFromForm();
                // ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ - ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å‡∏ü‡∏≠‡∏£‡πå‡∏°
                if (oldStatus !== newStatus) {
                    report.status = newStatus;
                    
                    if (newStatus === 'progress' && !report.startTime) {
                        // ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°
                        report.startTime = now;
                        report.timeLog.push({
                            action: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°',
                            timestamp: now,
                            user: report.assignedTo || '‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ',
                            details: `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏° - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°: ${formatDateTime(now)}`,
                            autoTime: true
                        });
                    } else if (newStatus === 'completed') {
                        if (!report.completedTime) {
                            // ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                            report.completedTime = now;
                            
                            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°
                            const startTime = report.startTime || report.reportTime;
                            if (startTime) {
                                report.totalRepairTime = calculateDuration(startTime, report.completedTime);
                            }
                            
                            report.timeLog.push({
                                action: '‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à',
                                timestamp: now,
                                user: report.assignedTo || '‡∏ä‡πà‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ',
                                details: `‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à: ${formatDateTime(now)}${report.totalRepairTime ? ` | ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°: ${report.totalRepairTime}` : ''}`,
                                autoTime: true
                            });
                        }
                    } else if (newStatus === 'cancelled') {
                        report.timeLog.push({
                            action: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô',
                            timestamp: now,
                            user: report.assignedTo || '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
                            details: `‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏° - ‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å: ${formatDateTime(now)}`,
                            autoTime: true
                        });
                    } else {
                        report.timeLog.push({
                            action: '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                            timestamp: now,
                            user: report.assignedTo || '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
                            details: `‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å "${getStatusText(oldStatus)}" ‡πÄ‡∏õ‡πá‡∏ô "${getStatusText(newStatus)}" - ‡πÄ‡∏ß‡∏•‡∏≤: ${formatDateTime(now)}`,
                            autoTime: true
                        });
                    }
                } else {
                    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô
                    report.timeLog.push({
                        action: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
                        timestamp: now,
                        user: report.assignedTo || '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
                        details: `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° - ‡πÄ‡∏ß‡∏•‡∏≤: ${formatDateTime(now)}`,
                        autoTime: true
                    });
                }
                
                // Save to localStorage
                saveToLocalStorage();
                
                
                // Sync EDIT changes to Google Sheets
                (function(){ const __newLogs = (report.timeLog||[]).slice(__prevLen); gasUpsert(report, __newLogs); })();
                updateDashboard();
                renderRecentReports();
                renderManageReports();
                renderHistoryReports();
                
                closeEditModal();
                
                // Show success message with time info
                let message = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!';
                if (newStatus === 'progress' && oldStatus !== 'progress') {
                    message += `\n‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°: ${formatDateTime(now)}`;
                } else if (newStatus === 'completed' && oldStatus !== 'completed') {
                    message += `\n‚úÖ ‡πÄ‡∏ß‡∏•‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à: ${formatDateTime(now)}`;
                    if (report.totalRepairTime) {
                        message += `\n‚è±Ô∏è ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°: ${report.totalRepairTime}`;
                    }
                }
                alert(message);
            }
        });

        // Assign form submission
        document.getElementById('assign-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const id = document.getElementById('assign-id').value;
            const technician = document.getElementById('assign-technician').value;
            const notes = document.getElementById('assign-notes').value;
            
            const report = repairReports.find(r => r.id === id);
            
            if (report) {
                const __prevLenA = (report.timeLog ? report.timeLog.length : 0);
                const now = new Date().toISOString();
                report.assignedTo = technician;
                report.status = 'progress';
                
                // ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°
                if (notes) {
                    report.notes = report.notes ? report.notes + '\n' + notes : notes;
                }
                
                // Add time log entries with automatic timestamps
                report.timeLog.push({
                    action: '‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô',
                    timestamp: now,
                    user: '‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡πà‡∏≤‡∏á',
                    details: `‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ ${technician}${notes ? ` - ${notes}` : ''} - ‡πÄ‡∏ß‡∏•‡∏≤‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢: ${formatDateTime(now)}`,
                    autoTime: true
                });
                
                report.timeLog.push({
                    action: '‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°',
                    timestamp: now,
                    user: '‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥',
                    details: `‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏° - ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°: ${formatDateTime(now)}`,
                    autoTime: true
                });
                
                // Save to localStorage
                saveToLocalStorage();
                
                
                // Sync ASSIGN changes to Google Sheets
                (function(){ const __newLogs = (report.timeLog||[]).slice(__prevLenA); gasUpsert(report, __newLogs); })();
                updateDashboard();
                renderRecentReports();
                renderManageReports();
                renderHistoryReports();
                
                closeAssignModal();
                
                // Show success message
                alert(`‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ ${technician} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!\n‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°: ${formatDateTime(now)}`);
            }
        });

        function filterReports() {
            renderManageReports();
        }

        function getStatusClass(status) {
            const classes = {
                pending: 'bg-yellow-100 text-yellow-800',
                progress: 'bg-blue-100 text-blue-800',
                completed: 'bg-green-100 text-green-800',
                cancelled: 'bg-red-100 text-red-800'
            };
            return classes[status] || 'bg-gray-100 text-gray-800';
        }

        function getStatusText(status) {
            const texts = {
                pending: '‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
                progress: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
                completed: '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô',
                cancelled: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
            };
            return texts[status] || status;
        }

        function getPriorityClass(priority) {
            const classes = {
                low: 'bg-gray-100 text-gray-800',
                medium: 'bg-yellow-100 text-yellow-800',
                high: 'bg-orange-100 text-orange-800',
                urgent: 'bg-red-100 text-red-800'
            };
            return classes[priority] || 'bg-gray-100 text-gray-800';
        }

        function getPriorityText(priority) {
            const texts = {
                low: '‡∏ï‡πà‡∏≥',
                medium: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',
                high: '‡∏™‡∏π‡∏á',
                urgent: '‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô'
            };
            return texts[priority] || priority;
        }

        function getDepartmentText(department) {
            const texts = {
                production: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ú‡∏•‡∏¥‡∏ï',
                maintenance: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á',
                quality: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û',
                warehouse: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤',
                office: '‡πÅ‡∏ú‡∏ô‡∏Å‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô'
            };
            return texts[department] || department;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        function formatDateTime(dateTimeString) {
            if (!dateTimeString) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function calculateDuration(startTime, endTime) {
            if (!startTime || !endTime) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            
            const start = new Date(startTime);
            const end = new Date(endTime);
            const diffMs = end - start;
            
            const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
            
            let result = '';
            if (days > 0) result += `${days} ‡∏ß‡∏±‡∏ô `;
            if (hours > 0) result += `${hours} ‡∏ä‡∏°. `;
            if (minutes > 0) result += `${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ`;
            
            return result.trim() || '< 1 ‡∏ô‡∏≤‡∏ó‡∏µ';
        }

        function formatDateTimeForInput(dateTimeString) {
            if (!dateTimeString) return '';
            const date = new Date(dateTimeString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // Mobile Menu Functions
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            menu.classList.toggle('hidden');
        }

        function toggleMobileDataMenu() {
            const menu = document.getElementById('mobile-data-menu');
            menu.classList.toggle('hidden');
        }

        // Data Management Functions
        function toggleDataMenu() {
            const menu = document.getElementById('data-menu');
            menu.classList.toggle('hidden');
            
            // Close menu when clicking outside
            document.addEventListener('click', function closeMenu(e) {
                if (!e.target.closest('#data-menu') && !e.target.closest('button[onclick="toggleDataMenu()"]')) {
                    menu.classList.add('hidden');
                    document.removeEventListener('click', closeMenu);
                }
            });
        }

        function exportData() {
            try {
                // Create CSV headers
                const headers = [
                    '‡∏£‡∏´‡∏±‡∏™‡πÅ‡∏à‡πâ‡∏á‡∏ã‡πà‡∏≠‡∏°',
                    '‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£',
                    '‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á',
                    '‡πÅ‡∏ú‡∏ô‡∏Å',
                    '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô',
                    '‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á',
                    '‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤',
                    '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞',
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á',
                    '‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ã‡πà‡∏≠‡∏°',
                    '‡πÄ‡∏ß‡∏•‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à',
                    '‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏ß‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°',
                    '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö',
                    '‡∏ú‡∏π‡πâ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
                    '‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ',
                    '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏'
                ];
                
                // Create CSV rows
                const csvRows = [headers.join(',')];
                
                repairReports.forEach(report => {
                    const row = [
                        `"${report.id || ''}"`,
                        `"${report.machineName || ''}"`,
                        `"${report.machineCode || ''}"`,
                        `"${getDepartmentText(report.department) || ''}"`,
                        `"${getPriorityText(report.priority) || ''}"`,
                        `"${report.reporter || ''}"`,
                        `"${(report.problem || '').replace(/"/g, '""')}"`,
                        `"${getStatusText(report.status) || ''}"`,
                        `"${report.reportTime ? formatDateTime(report.reportTime) : ''}"`,
                        `"${report.startTime ? formatDateTime(report.startTime) : ''}"`,
                        `"${report.completedTime ? formatDateTime(report.completedTime) : ''}"`,
                        `"${report.totalRepairTime || (report.completedTime && (report.startTime || report.reportTime) ? calculateDuration(report.startTime || report.reportTime, report.completedTime) : '')}"`,
                        `"${report.assignedTo || ''}"`,
                        `"${report.approvedBy || ''}"`,
                        `"${report.parts && report.parts.length > 0 ? report.parts.map(p => `${p.name} (${p.quantity} ‡∏ä‡∏¥‡πâ‡∏ô)`).join('; ') : ''}"`,
                        `"${(report.notes || '').replace(/"/g, '""')}"`
                    ];
                    csvRows.push(row.join(','));
                });
                
                // Create CSV content with BOM for proper Thai character display
                const csvContent = '\uFEFF' + csvRows.join('\n');
                const dataBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `repair-system-data-${new Date().toISOString().split('T')[0]}.csv`;
                link.click();
                
                // Hide menu
                document.getElementById('data-menu').classList.add('hidden');
                
                // Show success message
                showDataMessage(`‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${repairReports.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡πá‡∏ô CSV ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
                
            } catch (error) {
                console.error('Export error:', error);
                showDataMessage('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // Validate data structure
                        if (!data.repairReports || !Array.isArray(data.repairReports)) {
                            throw new Error('Invalid data format');
                        }
                        
                        // Confirm import
                        const confirmImport = confirm(
                            `‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${data.repairReports.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n` +
                            `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å: ${data.exportDate ? formatDateTime(data.exportDate) : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}\n\n` +
                            `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n` +
                            `(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡∏ö)`
                        );
                        
                        if (confirmImport) {
                            repairReports = data.repairReports;
                            nextId = data.nextId || (repairReports.length + 1);
                            
                            // Save to localStorage
                            saveToLocalStorage();
                            
                            // Update displays
                            updateDashboard();
                            renderRecentReports();
                            renderManageReports();
                            renderHistoryReports();
                            
                            showDataMessage(`‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${data.repairReports.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!`, 'success');
                        }
                        
                    } catch (error) {
                        console.error('Import error:', error);
                        showDataMessage('‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
            
            // Hide menu
            document.getElementById('data-menu').classList.add('hidden');
        }

        function clearAllData() {
            const confirmClear = confirm(
                `‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!\n\n` +
                `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${repairReports.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n` +
                `‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!\n` +
                `‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô`
            );
            
            if (confirmClear) {
                const doubleConfirm = confirm(
                    `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á!\n\n` +
                    `‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${repairReports.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?\n` +
                    `(‡∏Å‡∏î OK ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏ö, Cancel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å)`
                );
                
                if (doubleConfirm) {
                    repairReports = [];
                    nextId = 1;
                    
                    // Clear localStorage
                    localStorage.removeItem('repairSystemData');
                    
                    // Update displays
                    updateDashboard();
                    renderRecentReports();
                    renderManageReports();
                    renderHistoryReports();
                    
                    showDataMessage('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                }
            }
            
            // Hide menu
            document.getElementById('data-menu').classList.add('hidden');
        }

        function showDataMessage(message, type) {
            const messageDiv = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            const icon = type === 'success' ? 
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>' :
                '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>';
            
            messageDiv.className = `fixed top-4 right-4 ${bgColor} text-white px-6 py-4 rounded-lg shadow-lg z-50 transform transition-all duration-500`;
            messageDiv.innerHTML = `
                <div class="flex items-center space-x-3">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        ${icon}
                    </svg>
                    <div class="font-medium">${message}</div>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.style.transform = 'translateX(100%)';
                setTimeout(() => messageDiv.remove(), 500);
            }, 3000);
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96ed5f20645740fb',t:'MTc1NTE0MjIwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();
// === Edit form required validation ===
function checkEditRequired() {
  const statusEl = document.getElementById('edit-status');
  const assignedEl = document.getElementById('edit-assigned-to');
  const approvedEl = document.getElementById('edit-approved-by');
  const notesEl = document.getElementById('edit-notes');
  const saveBtn = document.getElementById('edit-save-btn');
  const hint = document.getElementById('edit-req-hint');

  const ok = Boolean(statusEl && statusEl.value) && Boolean(assignedEl && assignedEl.value) && Boolean(approvedEl && approvedEl.value) && Boolean(notesEl && notesEl.value.trim());
  if (saveBtn) {
    if (ok) {
      saveBtn.disabled = false;
      saveBtn.classList.remove('opacity-50','cursor-not-allowed');
      if (hint) hint.classList.add('hidden');
    } else {
      saveBtn.disabled = true;
      saveBtn.classList.add('opacity-50','cursor-not-allowed');
      if (hint) hint.classList.remove('hidden');
    }
  }
}

['edit-status','edit-assigned-to','edit-approved-by','edit-notes'].forEach(id => {
  document.addEventListener('input', (e) => {
    if (e.target && e.target.id === id) {
      checkEditRequired();
    }
  }, true);
});

// call when opening edit modal too
if (typeof editReport === 'function') {
  const __orig_editReport = editReport;
  editReport = function(id){
    __orig_editReport(id);
    setTimeout(checkEditRequired, 0);
  };
} else {
  // fallback
  document.addEventListener('DOMContentLoaded', checkEditRequired);
}

/* === Machine Code helpers: digits-only + NC.NO prefix === */
function onlyDigits(v){ return (v||'').toString().replace(/\D+/g,''); }
function formatMachineCode(raw){
  const d = onlyDigits(raw);
  return d ? 'NC.NO' + d : '';
}
// Restrict typing in machine-code field to digits, show digits only while typing
document.addEventListener('input', (e)=>{
  if(e && e.target && e.target.id === 'machine-code'){
    const el = e.target;
    const caret = el.selectionStart;
    const dig = onlyDigits(el.value);
    el.value = dig;
    try{ el.setSelectionRange(caret, caret); }catch(_){}
  }
}, true);
</script></body>
</html>
